<!DOCTYPE html>
<html class="light" lang="es">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Mi Perfil - Sistema de Lectura IA</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
      rel="stylesheet"
    />
    <script id="tailwind-config">
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#4396ea",

              "background-light": "#f6f7f8",
              "background-dark": "#111921",
            },
            fontFamily: {
              display: ["Inter", "sans-serif"],
            },
            borderRadius: {
              DEFAULT: "0.25rem",
              lg: "0.5rem",
              xl: "0.75rem",
              full: "9999px",
            },
          },
        },
      };
    </script>
    <link rel="stylesheet" href="/css/main.css" />
  </head>
  <body
    class="bg-background-light dark:bg-background-dark font-display text-[#0e141b] dark:text-slate-200"
  >
    <div class="relative flex min-h-screen w-full">
      <%- include('../partials/siderbar_estudiante', { active: active, user:
      user }) %>

      <main class="flex-1 p-6 lg:p-10">
        <div class="w-full max-w-4xl mx-auto">
          <div class="flex min-w-72 flex-col gap-3">
            <p
              class="text-[#0e141b] dark:text-slate-50 text-4xl font-black leading-tight tracking-[-0.033em]"
            >
              Mi Perfil
            </p>
            <p
              class="text-[#4e7397] dark:text-slate-400 text-base font-normal leading-normal"
            >
              Consulta y actualiza tu información personal.
            </p>
          </div>
          <div class="mt-8">
            <div
              class="bg-white dark:bg-slate-800/50 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700/50 p-6 md:p-8"
            >
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div
                  class="flex flex-col items-center md:items-center text-center"
                >
                  <form
                    action="/perfil/actualizar-foto"
                    method="POST"
                    enctype="multipart/form-data"
                    id="form-foto"
                  >
                    <div class="relative">
                      <div
                        class="w-32 h-32 rounded-full bg-cover bg-center bg-slate-200 dark:bg-slate-700 mx-auto"
                        style="
                          background-image: url(&quot;<%= user.avatarUrl %>&quot;);
                        "
                      ></div>
                      <label
                        for="input-avatar"
                        class="absolute bottom-0 right-[10px] flex items-center justify-center w-9 h-9 bg-primary rounded-full text-white cursor-pointer hover:bg-opacity-90 transition-all active:scale-95"
                      >
                        <span class="material-symbols-outlined text-xl"
                          >edit</span
                        >
                      </label>
                    </div>
                    <input
                      type="file"
                      name="avatar"
                      id="input-avatar"
                      class="hidden"
                    />
                    <p class="text-sm text-[#4e7397] dark:text-slate-400 mt-3">
                      Haz clic en el lápiz para cambiar tu foto.
                    </p>
                  </form>

                  <form
                    action="/perfil/eliminar-foto"
                    method="POST"
                    class="mt-2"
                  >
                    <button
                      type="submit"
                      class="inline-flex items-center justify-center h-9 px-3 rounded-lg border border-red-300 text-sm font-medium text-red-600 hover:bg-red-50 active:scale-[.99] transition dark:border-red-500/30 dark:text-red-400 dark:hover:bg-red-500/10"
                    >
                      Eliminar foto
                    </button>
                  </form>
                  <div class="w-full mt-4 text-center md:text-left">
                    <p class="text-xl font-bold text-primary">
                      Nivel <%= nivel %>
                    </p>
                    <p class="text-xs text-slate-500 dark:text-slate-400">
                      Te faltan <%= xpParaSiguiente %> XP para el siguiente
                      nivel
                    </p>
                    <div
                      class="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2.5 mt-2"
                    >
                      <div
                        class="bg-primary h-2.5 rounded-full"
                        style="width: <%= progresoXP %>%"
                      ></div>
                    </div>
                  </div>
                </div>

                <div class="md:col-span-2">
                  <form
                    class="space-y-3"
                    action="/perfil/actualizar-info"
                    method="POST"
                  >
                    <div>
                      <label
                        class="text-sm font-medium text-[#0e141b] dark:text-slate-300"
                        for="nombres"
                        >Nombres</label
                      >
                      <input
                        class="mt-1 block w-full rounded-lg border-slate-300 bg-slate-200 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-400"
                        id="nombres"
                        type="text"
                        value="<%= user.nombres %>"
                        readonly
                      />
                    </div>
                    <div>
                      <label
                        class="text-sm font-medium text-[#0e141b] dark:text-slate-300"
                        for="apellidos"
                        >Apellidos</label
                      >
                      <input
                        class="mt-1 block w-full rounded-lg border-slate-300 bg-slate-200 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-400"
                        id="apellidos"
                        type="text"
                        value="<%= user.apellidos %>"
                        readonly
                      />
                    </div>
                    <div>
                      <label
                        class="text-sm font-medium text-[#0e141b] dark:text-slate-300"
                        for="email"
                        >Correo Electrónico</label
                      >
                      <input
                        class="mt-1 block w-full rounded-lg border-slate-300 bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-50"
                        id="email"
                        name="email"
                        type="email"
                        value="<%= user.email %>"
                      />
                    </div>
                    <div>
                      <label
                        class="text-sm font-medium text-[#0e141b] dark:text-slate-300"
                        for="grado"
                        >Grado</label
                      >
                      <input
                        class="mt-1 block w-full rounded-lg border-slate-300 bg-slate-200 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-400"
                        id="grado"
                        type="text"
                        value="<%= user.grado %>"
                        readonly
                      />
                    </div>
                    <div class="flex justify-end gap-1 pt-0">
                      <button
                        class="flex min-w-[120px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-6 bg-primary text-slate-50 text-sm font-medium"
                        type="submit"
                      >
                        <span class="truncate">Guardar Cambios</span>
                      </button>
                    </div>
                  </form>

                  <div
                    class="border-t border-slate-200 dark:border-slate-700 pt-6 mt-8"
                  >
                    <p
                      class="text-base font-medium text-[#0e141b] dark:text-slate-200"
                    >
                      Seguridad
                    </p>
                    <form
                      class="space-y-3 mt-2"
                      action="/perfil/actualizar-password"
                      method="POST"
                    >
                      <div>
                        <label
                          class="text-sm font-medium text-[#0e141b] dark:text-slate-300"
                          for="password_actual"
                          >Contraseña Actual</label
                        >
                        <input
                          class="mt-1 block w-full rounded-lg border-slate-300 bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-50"
                          id="password_actual"
                          name="password_actual"
                          type="password"
                          required
                        />
                      </div>
                      <div>
                        <label
                          class="text-sm font-medium text-[#0e141b] dark:text-slate-300"
                          for="password_nueva"
                          >Nueva Contraseña</label
                        >
                        <input
                          class="mt-1 block w-full rounded-lg border-slate-300 bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-50"
                          id="password_nueva"
                          name="password_nueva"
                          type="password"
                          required
                        />
                      </div>
                      <div>
                        <label
                          class="text-sm font-medium text-[#0e141b] dark:text-slate-300"
                          for="password_confirmar"
                          >Confirmar Nueva Contraseña</label
                        >
                        <input
                          class="mt-1 block w-full rounded-lg border-slate-300 bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-50"
                          id="password_confirmar"
                          name="password_confirmar"
                          type="password"
                          required
                        />
                      </div>
                      <div class="flex justify-end gap-1 pt-0">
                        <button
                          class="flex min-w-[120px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-6 bg-primary text-slate-50 text-sm font-medium"
                          type="submit"
                        >
                          <span class="truncate">Cambiar Contraseña</span>
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
    <script>
      // Espera a que la página cargue
      document.addEventListener("DOMContentLoaded", function () {
        // 1. Encuentra el input de la foto
        const inputAvatar = document.getElementById("input-avatar");

        // 2. Encuentra el formulario que debe enviarse
        const formFoto = document.getElementById("form-foto");

        // 3. Añade un "escuchador" de eventos
        if (inputAvatar && formFoto) {
          inputAvatar.addEventListener("change", function () {
            // Cuando el input cambie (se seleccione un archivo),
            // envía el formulario.
            console.log("Archivo seleccionado. Enviando formulario de foto...");
            formFoto.submit();
          });
        }
      });
    </script>
  </body>
</html>
